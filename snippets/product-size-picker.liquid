{% comment %}
  Renders product variant-picker

  Accepts:
  - product: {Object} product object.
  - wrapper_class: {String} additional class for the wrapper
  - submit_on_click: {Boolean} should clicking an option add to cart or show a seperate button for adding to cart.
  - is_modal: {Boolean} is modal or hover
  - id: {String} parent id.

  Usage:
  {% render 'product-size-picker', product: product %}
{% endcomment %}

{%- unless product.has_only_default_variant -%}
    {% if is_modal %}
        <div class="variant_modal_overlay" id="{{ id | append: "-overlay" }}">&nbsp;</div>
        <div class="variant_modal variant_selector submit_on_click"
             id="{{ id }}">
            <div class="quick-add-variant-modal mobile no-js-hidden"
                 id="quick_add_modal-{{ section.id }}-{{ card_product.id }}">
                <div class="product-size-picker-container">
                    <div class="product_details">
                        {%- assign height = product.featured_media.width | divided_by: product.featured_media.aspect_ratio | round -%}

                        {{ product.featured_media | image_url: width: 375 | image_tag:
                        loading: 'lazy',
                        height: height,
                        class: "product_details__image",
                        sizes: "100vw",
                        widths: '375'
                        }}
                        <div class="product_details__info">
                            {{ product.title }}
                            {% render "price", product: product %}
                        </div>
                        <div class="quick_add_modal__close">
                            {% render 'icon-close' %}
                        </div>
                    </div>
                    <span class="product_size_picker__heading">{{ section.settings.quick_add_text }} sss</span>
                    <div class="product-size-picker">
                        <product-form class="size-variant-product-form">
                            {%- form 'product', product, class: 'product_size_picker__form form', data-type: 'add-to-cart-form' -%}
                                <div class="product_variants {% if product.has_only_default_variant %}none{% endif %}">
                                    <ul>
                                        {% for variant in product.variants %}
                                            {% unless variant.title == '39' %}
                                                {%- liquid
                                                    assign product_disabled = false
                                                    if variant.available == false
                                                        assign product_disabled = true
                                                    endif
                                                    if product.title contains 'Chummy' and variant.title != "L"
                                                        assign product_disabled = true
                                                    elsif variant.title == '39'
                                                        assign product_disabled = true
                                                    endif
                                                %}

                                                <li class="size_variant_button{% if product_disabled %} disabled-variant-button{% endif %}">
                                                    <div class="size_variant_button_container">
                                                        <input type="radio"
                                                               data-variant-id="{{ variant.id }}"
                                                               name="id"
                                                               value="{{ variant.id }}"
                                                               id="radio_{{ variant.id }}"
                                                                {% if product_disabled %} disabled{% endif %}
                                                        {% if product.has_only_default_variant %}class="product_size_picker__button default_input"
                                                            checked{% else %}class="product_size_picker__button new_input shoppable"{% endif %}>
                                                        <label for="radio_{{ variant.id }}"
                                                               class="product_size_picker__button__label {% if product.selected_variant == variant %}selected{% endif %}">
                                                            {{ variant.title | escape }}
                                                            <span class="visually-hidden">{{ 'products.product.variant_sold_out_or_unavailable' | t }}</span>
                                                        </label>
                                                    </div>
                                                    <div class="size_variant_button_add">
                                                        {% render 'icon-plus' %}
                                                    </div>
                                                </li>
                                            {% endunless %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            {%- endform -%}
                        </product-form>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div id="{{ id }}"
             class="variant_selector{% if submit_on_click %} submit_on_click{% endif %} {{ wrapper_class }}">
            <product-form class="size-variant-product-form">
                {%- form 'product', product, class: 'product_size_picker__form form', data-type: 'add-to-cart-form' -%}
                    <div class="product_variants {% if product.has_only_default_variant %}none{% endif %}">
                        <ul>
                            {% for variant in product.variants %}
                                {% unless variant.title == '39' %}
                                    {%- liquid
                                        assign product_disabled = false
                                        if variant.available == false
                                            assign product_disabled = true
                                        endif
                                        if product.title contains 'Chummy' and variant.title != "L"
                                            assign product_disabled = true
                                        elsif variant.title == '39'
                                            assign product_disabled = true
                                        endif
                                    %}

                                    <li class="size_variant_button{% if product_disabled %} disabled-variant-button{% endif %}">
                                        <div class="size_variant_button_container">
                                            <input type="radio"
                                                   data-variant-id="{{ variant.id }}"
                                                   name="id"
                                                   value="{{ variant.id }}"
                                                   id="radio_{{ variant.id }}"
                                                    {% if product_disabled %} disabled{% endif %}
                                            {% if product.has_only_default_variant %}class="product_size_picker__button default_input"
                                                checked{% else %}class="product_size_picker__button new_input shoppable"{% endif %}>
                                            <label for="radio_{{ variant.id }}"
                                                   class="product_size_picker__button__label {% if product.selected_variant == variant %}selected{% endif %}">
                                                {{ variant.title | escape }}
                                                <span class="visually-hidden">{{ 'products.product.variant_sold_out_or_unavailable' | t }}</span>
                                            </label>
                                        </div>
                                    </li>
                                {% endunless %}
                            {% endfor %}
                        </ul>
                    </div>
                    {% comment %} TODO: Make ajax add to cart open cart widget {% endcomment %}
                    <div class="add_to_cart_container product-form__buttons">
                        {% if product.tags contains 'fakeOutOfStock' %}
                            <button class="soldout-variant fakeOutOfStock">
                                אזל המלאי
                            </button>
                        {% else %}
                            <button type="submit"
                                    name="add"
                                    class="add_to_cart product-form__submit button button--full-width button--secondary">
                                הוספה
                            </button>
                        {% endif %}
                    </div>
                {%- endform -%}
            </product-form>
        </div>
    {% endif %}
{%- endunless -%}
